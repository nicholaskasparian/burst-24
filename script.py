import time
import os
from datetime import date, timedelta, datetime
from dotenv import load_dotenv
from alpaca.data.historical import StockHistoricalDataClient
from alpaca.data.requests import StockBarsRequest
from alpaca.data.timeframe import TimeFrame
from alpaca.trading.client import TradingClient
from alpaca.trading.requests import MarketOrderRequest
from alpaca.trading.enums import OrderSide, TimeInForce
import random
load_dotenv()
APCA_API_KEY_ID = os.getenv('APCA_API_KEY_ID')
APCA_API_SECRET_KEY = os.getenv('APCA_API_SECRET_KEY')
count = 0
amtTotal = 0
riskTolerance = random.randint(1500, 3000)
print(f"Risk tolerance: {riskTolerance}.")
time.sleep(3)

trading_client = TradingClient(APCA_API_KEY_ID, APCA_API_SECRET_KEY, paper=True)
trading_client.close_all_positions(cancel_orders=True)

def buy(symbol, amt, side):
    if side == "bull":
        market_order_data = MarketOrderRequest(
            symbol=str(symbol),
            notional=round(float(amt),2),
            side=OrderSide.BUY,
            time_in_force=TimeInForce.DAY
        )
        market_order = trading_client.submit_order(
            order_data=market_order_data
        )
    elif side == "bear":
        market_order_data = MarketOrderRequest(
            symbol=str(symbol),
            qty=amt,
            side=OrderSide.SELL,
            time_in_force=TimeInForce.DAY
        )

        market_order = trading_client.submit_order(
            order_data=market_order_data
        )


today = date.today()

client = StockHistoricalDataClient(APCA_API_KEY_ID, APCA_API_SECRET_KEY)

yesterday = date.today() - timedelta(days=1)

tradeable = ["NVDA", "AAPL", "MSFT", "AMZN", "AVGO", "GOOGL", "META", "GOOG", "TSLA", "BRKB", "JPM", "LLY", "V", "XOM", "NFLX", "JNJ", "MA", "WMT", "PLTR", "ORCL", "AMD", "COST", "ABBV", "HD", "BAC", "PG", "GE", "UNH", "CVX", "CSCO", "IBM", "WFC", "KO", "CAT", "MU", "CRM", "RTX", "GS", "PM", "MRK", "TMO", "ABT", "MCD", "DIS", "LRCX", "PEP", "AXP", "LIN", "QCOM", "UBER", "ISRG", "NOW", "MS", "AMAT", "C", "INTU", "INTC", "T", "APH", "VZ", "NEE", "BKNG", "BLK", "ANET", "SCHW", "KLAC", "AMGN", "GEV", "ACN", "TJX", "APP", "ETN", "SPGI", "GILD", "BSX", "TXN", "BA", "ADBE", "PANW", "PFE", "COF", "DHR", "LOW", "CRWD", "UNP", "HON", "SYK", "WELL", "PGR", "CEG", "MDT", "ADI", "PLD", "COP", "DE", "VRTX", "HOOD", "BX", "ADP", "XTSLA", "SO", "LMT", "CB", "MCK", "CMCSA", "SPOT", "TT", "PH", "CVS", "DUK", "CME", "TMUS", "MO", "BMY", "CDNS", "SBUX", "DASH", "NEM", "MMM", "MMC", "GD", "SNOW", "SNPS", "AMT", "ICE", "EQIX", "HWM", "MRVL", "SHW", "CRH", "ORLY", "KKR", "NOC", "HCA", "EMR", "NET", "BK", "JCI", "MCO", "NKE", "WM", "MDLZ", "VRT", "USB", "TDG", "PNC", "RCL", "COIN", "ELV", "ITW", "AON", "UPS", "MSTR", "WMB", "GLW", "RBLX", "REGN", "MSI", "CSX", "PYPL", "PWR", "GM", "CI", "AEP", "ZTS", "ECL", "ADSK", "NSC", "VST", "CTAS", "AJG", "CL", "COR", "AZO", "TRV", "CMI", "SRE", "MPC", "HLT", "FCX", "MAR", "EOG", "TFC", "DLR", "SPG", "ALNY", "URI", "PSX", "FTNT", "NU", "AXON", "FDX", "APD", "SLB", "LHX", "ABNB", "VLO", "O", "WBD", "AFL", "WDC", "APO", "F", "BDX", "WDAY", "ROST", "IDXX", "KMI", "PCAR", "ALL", "EA", "DDOG", "D", "DELL", "XEL", "FERG", "ROP", "BKR", "FAST", "EW", "CARR", "AME", "TTWO", "LNG", "EXC", "MNST", "MPWR", "CAH", "AIG", "CBRE", "MET", "PSA", "MSCI", "AMP", "GWW", "VEEV", "ETR", "CMG", "CTVA", "OKE", "A", "RSG", "TGT", "ROK", "XYZ", "FLUT", "CVNA", "PEG", "DHI", "KMB", "CPNG", "FICO", "CCI", "KR", "YUM", "VMC", "CPRT", "PAYX", "EBAY", "DAL", "OTIS", "XYL", "PRU", "MLM", "IQV", "RMD", "CTSH", "FI", "SYY", "WEC", "INSM", "NDAQ", "HIG", "KDP", "ED", "WAB", "PCG", "GRMN", "NUE", "AU", "DD", "GEHC", "SOFI", "FIX", "HUM", "VTR", "MCHP", "EQT", "STT", "TRGP", "FIS", "NRG", "HPE", "ZS", "ACGL", "VICI", "KEYS", "CCL", "WTW", "UAL", "IR", "VRSK", "PSTG", "IRM", "IBKR", "LPLA", "EME", "TER", "MTD", "OXY", "ADM", "RJF", "MTB", "TSCO", "CSGP", "MDB", "DTE", "SYF", "BE", "EXR", "FITB", "ARES", "LEN", "CRDO", "KVUE", "AEE", "ATO", "PPL", "TEAM", "CIEN", "FANG", "FSLR", "ES", "SNDK", "SMCI", "EXPE", "CBOE", "ODFL", "RKLB", "EFX", "HPQ", "BR", "NTRA", "GIS", "HUBB", "FE", "CNP", "AWK", "HUBS", "DOV", "AVB", "HSY", "NTRS", "MKL", "TDY", "RDDT", "LDOS", "HBAN", "FLEX", "NTAP", "CINF", "JBL", "PHM", "ALAB", "LYV", "VLTO", "PTC", "ULTA", "STE", "ZM", "K", "WSM", "HAL", "DXCM", "TPR", "EXE", "BIIB", "EQR", "TTD", "STLD", "CW", "TROW", "PPG", "CFG", "BRO", "PODD", "EL", "CMS", "DG", "RF", "LH", "CHD", "QSR", "EIX", "FWONK", "CHTR", "KHC", "DRI", "ON", "WAT", "WRB", "CDW", "BAM", "WST", "DVN", "SBAC", "IP", "TYL", "COHR", "VRSN", "NVR", "UTHR", "ZBH", "DLTR", "NI", "GWRE", "ILMN", "PINS", "DGX", "BWXT", "AFRM", "TRMB", "CASY", "SW", "TWLO", "STZ", "LVS", "GPN", "NVT", "IT", "J", "PFG", "HEIA", "RBA", "GDDY", "SSNC", "TLN", "AMCR", "NTNX", "THC", "CTRA", "LULU", "ACM", "CNC", "CPAY", "TPL", "EVRG", "CHRW", "FTAI", "GPC", "APTV", "PKG", "PNR", "BURL", "SNA", "FCNCA", "INVH", "FTI", "IONQ", "L", "EXPD", "FTV", "LNT", "WY", "DOW", "KEY", "HOLX", "USFD", "TOST", "MKC", "XPO", "SUI", "ESS", "IFF", "ROL", "SGI", "RKT", "LII", "BBY", "TRU", "FN", "ASTS", "CRS", "RS", "WWD", "PFGC", "DT", "EQH", "OKTA", "INCY", "MAA", "KTOS", "DOCU", "RPRX", "DKNG", "NXT", "DKS", "TXT", "JLL", "TSN", "OMC", "GEN", "WPC", "FFIV", "ITT", "FNF", "OKLO", "RGLD", "ALLE", "LUV", "FOXA", "EWBC", "RPM", "AVY", "LITE", "NBIX", "RGTI", "KIM", "CG", "CSL", "CLX", "JBHT", "ATI", "TOL", "CF", "MAS", "ENTG", "COO", "ZBRA", "NLY", "GGG", "APG", "HEI", "MEDP", "RBC", "ROKU", "BALL", "EG", "LECO", "HII", "TKO", "IEX", "BLDR", "MTZ", "CACI", "WSO", "UNM", "DPZ", "DOC", "BG", "NDSN", "DECK", "RL", "SNX", "REG", "TW", "WCC", "VTRS", "UHS", "SF", "RNR", "SCCO", "LYB", "BLD", "OHI", "RGA", "GLPI", "SCI", "SWKS", "Z", "U", "ELS", "AYI", "EXAS", "AVAV", "STRL", "IONS", "EHC", "BJ", "MLI", "ALB", "GH", "CCK", "RMBS", "MANH", "HST", "RVTY", "TXRH", "AKAM", "UDR", "JKHY", "BXP", "EVR", "OC", "AIZ", "GL", "DTM", "CPT", "ELAN", "IOT", "PNW", "WTRG", "FHN", "DAY", "CDE", "SPXC", "CLH", "VIK", "BAH", "HAS", "SJM", "QBTS", "QXO", "RIVN", "ALLY", "RVMD", "AMH", "EXEL", "AGNC", "LAMR", "LUMN", "SWK", "FDS", "DCI", "CMA", "NWSA", "SATS", "SOLV", "AIT", "QGEN", "ENSG", "OVV", "CNM", "WMS", "DUOL", "BMRN", "LSCC", "WBS", "WYNN", "ARMK", "CELH", "ARE", "HLI", "AES", "POOL", "TECH", "BBIO", "REXR", "GNRC", "PAYC", "DOX", "NCLH", "CR", "MRNA", "OWL", "IPG", "W", "IDCC", "MKSI", "ALGN", "BAX", "NYT", "CRL", "ORI", "MTSI", "BWA", "AA", "EPAM", "CNH", "RRX", "EGP", "OGE", "FLS", "GME", "GTLS", "LW", "AR", "IVZ", "DOCS", "FYBR", "SSB", "PEN", "RBRK", "FOX", "AFG", "KNSL", "PRI", "AWI", "FIVE", "AAL", "HIMS", "MOS", "ROIV", "VMI", "TTEK", "JAZZ", "PCOR", "LKQ", "DY", "APA", "PR", "MTCH", "WTFC", "RRC", "DINO", "LAD", "CUBE", "FLR", "OSK", "MP", "COLB", "MOH", "WAL", "ONON", "MOD", "RGEN", "HQY", "CAG", "SEIC", "JEF", "FRT", "HALO", "HL", "ADC", "QRVO", "BSY", "MSFUT", "MDGL", "JOBY", "AVTR", "BRX", "AOS", "UMBF", "TTC", "SFM", "LYFT", "ESTC", "SAIA", "INGR", "ZION", "OLLI", "SSD", "PLNT", "QS", "TAP", "ATR", "RNA", "CFR", "AXS", "BPOP", "XP", "FSS", "NNN", "TEM", "ACI", "AEIS", "VOYA", "NFG", "PRIM", "SANM", "SOLS", "LNC", "CTRE", "ALSN", "STAG", "EXP", "WTS", "TTMI", "OMF", "FR", "TPG", "CRUS", "KNX", "EMN", "SN", "ONB", "PATH", "JXN", "UGI", "CYTK", "APLD", "CMC", "CHWY", "CGNX", "MIR", "OLED", "R", "IDA", "HSIC", "CORT", "MARA", "ZWS", "AHR", "HRB", "BEN", "KD", "AL", "ONTO", "GMED", "COKE", "RIOT", "VNO", "MIDD", "AMG", "ESAB", "MUSA", "CBSH", "MGM", "ELF", "GXO", "SOUN", "FND", "JBTM", "AAON", "AXTA", "CFLT", "PNFP", "FAF", "CHDN", "KMX", "LNW", "ORA", "MTG", "ETSY", "PCTY", "CHE", "CART", "GTLB", "HRL", "AGCO", "WING", "SNV", "STWD", "FBIN", "IRTC", "HXL", "VNT", "BIO", "G", "BFAM", "VNOM", "PB", "BROS", "MAT", "CLF", "KEX", "REZI", "MASI", "ACHR", "SITM", "THG", "MKTX", "PEGA", "H", "NXST", "CRCL", "ARW", "TFX", "TMHC", "ESNT", "UEC", "CVLT", "SITE", "EXLS", "MHK", "ESI", "MOGA", "SMTC", "RYTM", "CORZ", "EPRT", "KBR", "SLM", "LBRDK", "LEU", "HR", "BOOT", "FCN", "FCFS", "CHRD", "NOV", "AM", "APPF", "CWST", "LFUS", "CPB", "PCVX", "LOPE", "MSA", "JHG", "MTN", "LEA", "UFPI", "SMR", "BBWI", "IBP", "BEPC", "RITM", "FNB", "GNTX", "RYAN", "WH", "LPX", "CADE", "BMI", "ESE", "ENS", "TRNO", "AUR", "DBX", "M", "PI", "BIPC", "WFRD", "PRMB", "CAVA", "TXNM", "GBCI", "PIPR", "GATX", "CLSK", "POR", "GAP", "STNE", "HOMB", "CRSP", "GTES", "NPO", "TGTX", "THO", "POST", "TREX", "AN", "AUB", "RDNT", "BDC", "SWX", "ALK", "MMSI", "RLI", "DAR", "SR", "PTCT", "VLY", "CIFR", "HWC", "RHP", "AXSM", "FTDR", "RDN", "GPI", "ROAD", "BILL", "OGS", "MORN", "OZK", "CNX", "MTH", "WEX", "BYD", "RAL", "S", "KRC", "ACIW", "KRYS", "EAT", "TKR", "GKOS", "ACA", "HUT", "ALKS", "ARWR", "VFC", "MTDR", "UHALB", "BCO", "TIGO", "SEE", "ST", "UBSI", "FOUR", "CCC", "BKH", "ABG", "OSIS", "SAIC", "SIGI", "BCPC", "BC", "NOVT", "GPK", "PTGX", "AS", "VSAT", "QLYS", "WTM", "KRG", "CROX", "DVA", "HLNE", "PSN", "ADT", "HRI", "BOX", "CWAN", "LAZ", "NEU", "SSRM", "SPR", "TNL", "LSTR", "ECG", "MMS", "ITRI", "AVT", "AGX", "UUUU", "NJR", "CNR", "SIG", "CZR", "ABCB", "TMDX", "OPCH", "PVH", "CE", "KTB", "SKYW", "BRKR", "GVA", "NUVL", "PECO", "KBH", "VIAV", "SBRA", "VVV", "FORM", "CUZ", "CVCO", "FELE", "RUN", "LLYVK", "WK", "CNO", "CSW", "AKRO", "SIRI", "ENPH", "SLAB", "TCBI", "MRP", "SNEX", "NE", "POWL", "PRAX", "MGY", "LNTH", "UPST", "MAC", "SXT", "MUR", "BFB", "AX", "URBN", "TDS", "WSC", "STEP", "BRBR", "AROC", "FFIN", "VRNS", "ASB", "VSEC", "SON", "PFSI", "MSM", "SARO", "MC", "PLXS", "WAY", "AGO", "VKTX", "WULF", "GLNG", "ATGE", "MWA", "SKY", "DLB", "LAUR", "CALM", "VRRM", "WHR", "ATMU", "MRCY", "EPR", "CRNX", "PJT", "ALE", "LGND", "QTWO", "MDU", "ADMA", "CALX", "ANF", "DORM", "AMBA", "HCC", "ALGM", "IESC", "COMP", "ACLX", "COLD", "IBOC", "PII", "ASO", "SLG", "SFBS", "NWS", "CBT", "OSCR", "INDB", "EXPO", "EOSE", "SKT", "INDV", "TVTX", "AMKR", "AMTM", "GFS", "UCB", "NWE", "GTM", "KNF", "IRT", "PATK", "MSGS", "KAI", "GNW", "FLG", "CRC", "SHAK", "RIG", "KFY", "MHO", "LOAR", "TENB", "CARG", "PRM", "COMM", "HAYW", "ZG", "TGNA", "TPC", "MTSR", "MYRG", "LTH", "VAL", "BXMT", "NVST", "HASI", "RYN", "RARE", "FHB", "ENVA", "PCH", "FUL", "FBP", "HOG", "JHX", "GHC", "RNST", "SLGN", "ZETA", "PAG", "BL", "EBC", "NHI", "PSMT", "LMND", "XENE", "BHF", "CDP", "BTU", "EEFT", "AZZ", "BNL", "MATX", "UI", "PL", "AVA", "TEX", "PBH", "PLMR", "BTSG", "TPH", "GFF", "WSFS", "OTTR", "BKU", "MPW", "AEO", "BGC", "CATY", "SPSC", "NMIH", "KYMR", "CXT", "HWKN", "MZTI", "STNG", "AIR", "CNK", "NATL", "AGYS", "MGEE", "ACAD", "CBU", "PLUG", "HIW", "SHC", "BFH", "HURN", "BCC", "REVG", "WHD", "CIVI", "YETI", "PRGO", "RUSHA", "FULT", "TBBK", "LRN", "NCNO", "MIRM", "WD", "PBF", "VIRT", "ABM", "KAR", "RXO", "VC", "VSCO", "LBRT", "CBZ", "CPK", "RHI", "NMRK", "AVNT", "ADPT", "FIBK", "KMPR", "RNG", "NSIT", "AAP", "CWEN", "SYNA", "AWR", "LIVN", "DK", "WSBC", "KGS", "FOLD", "IPGP", "SUPN", "FRHC", "BLKB", "SXI", "PTON", "LCII", "PINC", "RH", "VCYT", "DOCN", "ICUI", "DRS", "PENN", "SLNO", "APLE", "NG", "PRVA", "HP", "LXP", "RELY", "ACLS", "AMSC", "AGIO", "CHH", "INFA", "WDFC", "GPOR", "OLN", "IDYA", "DAN", "CPRX", "ATKR", "CWT", "RRR", "OUT", "HAE", "ALHC", "SBCF", "DXC", "VCTR", "PFS", "BOH", "ASH", "HGV", "GLOB", "YOU", "TARS", "EXTR", "SM", "XRAY", "JOE", "ACMR", "PTEN", "TDW", "WU", "MGRC", "GENI", "IAC", "FCPT", "DJT", "SHOO", "APAM", "POWI", "DYN", "EPAC", "LINE", "SFNC", "BANF", "NTB", "SRRK", "PHIN", "DIOD", "GRAL", "PRDO", "PARR", "CWK", "HUBG", "INOD", "CVBF", "UNF", "ATEC", "CPRI", "BOKF", "TRMK", "HBI", "COGT", "GSAT", "ARQT", "SDRL", "WLK", "APGE", "YELP", "CHEF", "OSW", "HHH", "KN", "CSGS", "PK", "CELC", "BEAM", "MGNI", "ALRM", "KLIC", "LCID", "FRSH", "SRPT", "FWONA", "AKR", "FRPT", "HI", "KRMN", "WGS", "BANR", "UE", "SMMT", "FLO", "ITGR", "DEI", "FBNC", "ADNT", "CAKE", "OII", "SEI", "SMG", "MTRN", "APLS", "FUN", "GTX", "CAR", "CXW", "FFBC", "WAFD", "CRVL", "FBK", "GEO", "BANC", "BIRK", "INSP", "PLUS", "BBAI", "SONO", "AVPT", "TOWN", "CURB", "GOLF", "TRN", "TDC", "CON", "VSH", "BATRK", "INSW", "EVTC", "CGON", "CNS", "MCY", "INTA", "IRDM", "PRK", "NOG", "NSA", "TIC", "ASGN", "CACC", "GRBK", "CNXC", "UNFI", "EYE", "RXRX", "HNI", "BUR", "ACHC", "DNLI", "BTDR", "AMR", "NGVT", "OCUL", "GT", "AMRX", "AI", "ADUS", "BRZE", "LBTYK", "CC", "WWW", "LQDA", "TNET", "HE", "FRME", "IVT", "QUBT", "WRBY", "ROCK", "BUSE", "VYX", "PAGS", "VICR", "FMC", "VCEL", "MSGE", "SAM", "DAVE", "PRGS", "DBRG", "TWST", "AUPH", "HCI", "SYBT", "CUBI", "OI", "KWR", "BLBD", "EFSC", "HMN", "LBTYA", "COCO", "PRKS", "CDTX", "UPWK", "KMT", "VAC", "ANIP", "SHO", "LIF", "BRSL", "OUST", "AORT", "IOSP", "WT", "CSTM", "CCOI", "NBTB", "KSS", "ADEA", "STC", "BCRX", "FIVN", "SPHR", "PRCT", "BLX", "NTST", "BBT", "BHE", "AVDL", "NTCT", "OGN", "IRON", "XMTR", "ARCB", "ENVX", "MTX", "BKD", "WKC", "MQ", "MNKD", "ANDE", "RAMP", "CASH", "SHLS", "CENX", "DDS", "VRDN", "HLIO", "NSSC", "AIN", "IPAR", "ENR", "STRA", "QDEL", "NWBI", "SMPL", "LC", "MLYS", "WLY", "CHCO", "XERS", "HTH", "ZD", "PZZA", "DRH", "TRIP", "CLDX", "OFG", "LLYVA", "ROG", "SGRY", "SPB", "VECO", "ENOV", "WOR", "GSHD", "MRX", "ARR", "VERX", "PAYO", "MBC", "PD", "WERN", "ALG", "HLMN", "CCS", "BELFB", "PRCH", "AAOI", "CRK", "DV", "CENTA", "ABR", "NHC", "CLVT", "SBH", "GNL", "ARLO", "ATRC", "NNI", "NSP", "DHT", "CECO", "LMAT", "TXG", "RCUS", "ATEN", "WEN", "UTI", "AAMI", "GABC", "IE", "DNOW", "PPTA", "BHVN", "FLYW", "DX", "LZB", "COLM", "SCS", "ARI", "STOK", "USLM", "AGM", "STEL", "DBD", "PPC", "IMVT", "NWN", "KALU", "PGNY", "NWL", "COTY", "IIPR", "ICFI", "RSI", "ELME", "PLAB", "OMCL", "SKWD", "TNK", "ASTH", "SGHC", "TRUP", "NIC", "WLDN", "DVAX", "BFA", "TDOC", "JANX", "SLVM", "UFPT", "XHR", "ATRO", "QCRH", "CLOV", "ACVA", "EWTX", "BKE", "KNTK", "CRGY", "HUN", "ALKT", "TNC", "WABC", "MAN", "SEM", "TPB", "BWIN", "LASR", "VRNT", "FCF", "JBI", "NVTS", "HCSG", "MODG", "LZ", "TILE", "GEF", "BFC", "PEB", "GO", "ARRY", "PRLB", "HTO", "LENB", "CLMT", "PAR", "TGLS", "MD", "DHC", "TALO", "NEOG", "JBGS", "GBX", "REYN", "TRS", "SAIL", "JJSF", "SILA", "LNN", "LTC", "XPRO", "VRE", "CTS", "METC", "NVCR", "LUNR", "CNMD", "HLIT", "NVAX", "TSHA", "LILAK", "LEG", "ARDX", "DXPE", "INVA", "UVV", "JBLU", "NEO", "LKFN", "ALIT", "FUBO", "JAMF", "CERT", "CNOB", "CRAI", "STBA", "MLKN", "HRMY", "SDGR", "COLL", "FLNC", "STAA", "MCRI", "ALEX", "GTY", "MRC", "SPNT", "REAL", "NPKI", "PCT", "TCBK", "LION", "CTRI", "RLJ", "AZTA", "SNDR", "FDP", "TFIN", "HOUS", "UPBD", "DGII", "PRA", "UCTT", "AMRC", "PENG", "THRM", "WINA", "NNE", "NAVI", "SFD", "CRI", "HOPE", "PGRE", "PGY", "BTBT", "CMPR", "PRG", "APPN", "NN", "IMAX", "NTGR", "AMWD", "USPH", "GIII", "VMEO", "ACT", "VERA", "CNNE", "WMK", "PWP", "MSEX", "TTI", "CCB", "WGO", "NBHC", "SPNS", "LADR", "BBNX", "DFIN", "COUR", "EPC", "NTLA", "REX", "IMKTA", "SCSC", "PHR", "FIHL", "ESRT", "PMT", "MVST", "VITL", "CDRE", "VRTS", "FIGS", "MXL", "UVE", "RPD", "BBSI", "GHM", "NVRI", "ELVN", "ASTE", "PEBO", "OCFC", "CSR", "ASAN", "MNMD", "LPG", "FSLY", "PDM", "ECPG", "PRO", "CVI", "SNDX", "AMPH", "SBSI", "ZYME", "MFA", "CBL", "EVLV", "ANAB", "BLFS", "IDT", "LOB", "COHU", "SCL", "GBTG", "SFL", "CTLP", "HSII", "WTTR", "HROW", "TDUP", "SAFT", "PLYM", "SMA", "DAKT", "EFC", "ERII", "APOG", "MDXG", "KOD", "CIM", "SEB", "PCRX", "ODP", "THR", "VTOL", "HG", "CWENA", "WS", "CRMD", "EIG", "PGEN", "FMBH", "TREE", "FOXF", "DCOM", "FTRE", "NUVB", "LGIH", "OBK", "UPB", "DRVN", "AXGN", "HLX", "SRCE", "NWPX", "THS", "SANA", "HPP", "CPF", "FA", "DCO", "DOLE", "KW", "LMB", "IAS", "CFFN", "CXM", "SLDP", "AAT", "HIPO", "AMC", "TWO", "UAA", "IART", "MEG", "SEZL", "FIZZ", "BHRB", "BBW", "ALGT", "ABUS", "TNDM", "UMH", "ORIC", "XPEL", "CNA", "HLF", "SENEA", "UA", "HAFC", "AQST", "MOFG", "SYRE", "SMBK", "DEA", "TBPH", "NRIX", "AESI", "FBRT", "DNTH", "LINC", "REPL", "LBRDA", "XNCR", "PDFS", "CMRE", "BZH", "LFST", "NRIM", "HNRG", "IMNM", "ODC", "ORC", "YEXT", "ORRF", "TMP", "CMPO", "OSBC", "CABO", "EMBC", "AIV", "RVLV", "VSTS", "SOC", "PNTG", "GRC", "HTB", "ESQ", "UNIT", "SXC", "UVSP", "HRTG", "TK", "IRMD", "GLIBK", "SAH", "MBWM", "ADCT", "SAFE", "BRSP", "ECVT", "HONE", "RBCAA", "PUMP", "GERN", "PAX", "LYTS", "PFBC", "BJRI", "SIBN", "CARS", "TFSL", "BLND", "HFWA", "INVX", "CPS", "RIGL", "BBUC", "TRST", "SCHL", "RYI", "FULC", "CWH", "CLB", "BY", "AMSF", "CTBI", "DLX", "WSR", "BORR", "KOS", "CBRL", "ADTN", "EVH", "CDNA", "URGN", "MCBS", "ESPR", "ALNT", "NAT", "TRNS", "NXRT", "VVX", "FLNG", "IIIV", "SMP", "AMN", "ZVRA", "AIP", "NBBK", "UWMC", "PLPC", "AXL", "NEXT", "MATW", "CNXN", "MYGN", "HTZ", "QNST", "HOV", "UFCS", "AHCO", "GLUE", "PRSU", "AOSL", "CCBG", "RGR", "WVE", "KE", "RUSHB", "INDI", "MTUS", "AEHR", "FIP", "GCT", "SVRA", "CSV", "SABR", "BV", "FOR", "HTBK", "MMI", "AMPL", "INGM", "BDN", "LENZ", "KURA", "TALK", "RWT", "MYE", "BCML", "OXM", "HSTM", "CCSI", "UTL", "NX", "GLDD", "ATUS", "EVER", "FBIZ", "ASC", "SKYT", "HBNC", "ROOT", "TR", "GDOT", "PLOW", "BCAL", "ICHR", "EXPI", "MCB", "ADAM", "ITIC", "ERAS", "SHEN", "LXU", "UTZ", "STGW", "LQDT", "AIOT", "MBIN", "DJCO", "SBGI", "MPB", "IBCP", "BFST", "CWCO", "PAHC", "EQBK", "SG", "PLSE", "UNTY", "BLMN", "PACB", "GOGO", "CYH", "CMP", "NAGE", "INBX", "PAYS", "DEC", "CEVA", "GNK", "HBCP", "IIIN", "DFH", "MGTX", "SPRY", "AVXL", "LIND", "CVLG", "BCAX", "SSTK", "CWBC", "AMBP", "ILPT", "WLFC", "INN", "ABSI", "BXC", "THFF", "GCMG", "NGNE", "CCRN", "EYPT", "ARVN", "MATV", "SNCY", "VEL", "ETD", "STKL", "ASIX", "FRBA", "KOP", "CGEM", "JBIO", "GSBC", "SWBI", "PFIS", "ACNB", "BWMN", "MRTN", "CARE", "ANGI", "CAC", "MBUU", "IMXI", "OMER", "FCBC", "RLAY", "RUM", "ATXS", "HCKT", "TBCH", "MVBF", "FDMT", "OFIX", "FMNB", "SPT", "AVBP", "NABL", "ACIC", "IBTA", "APPS", "BHB", "VTS", "GCI", "NECB", "AROW", "FSBC", "FG", "SEPN", "PLAY", "RRBI", "AMRK", "CSTL", "MBCN", "OPK", "BAND", "FWRD", "AMAL", "OIS", "HIFS", "DAWN", "BATRA", "OBT", "ARHS", "GRPN", "RM", "TRC", "SMBC", "AVNS", "HZO", "BWB", "CASS", "EU", "FISI", "EVCM", "ORGO", "KRRO", "RDVT", "AEVA", "ACEL", "GLRE", "SPFI", "HYLN", "ONIT", "CIVB", "AMTB", "KREF", "DGICA", "EGBN", "PRAA", "KFRC", "SFST", "ASPN", "BMBL", "TRTX", "CODI", "EE", "PACS", "WSBF", "CLBK", "KODK", "UDMY", "NUS", "CCNE", "CMPX", "FSBW", "HBT", "IOVA", "OSPN", "NFBK", "WRLD", "MLR", "CMCL", "UHAL", "PGC", "ANGO", "MNRO", "UHT", "PHAT", "JBSS", "TIPT", "ALX", "VPG", "WTBA", "PKE", "TSBK", "SD", "TROX", "HELE", "FRPH", "CLNE", "VIR", "CLFD", "AVO", "GEFB", "SRTA", "FLGT", "CAL", "ALRS", "RGNX", "PRTA", "BMRC", "LOCO", "FFIC", "BYRN", "EHAB", "ZUMZ", "NGVC", "GRNT", "VTLE", "IBRX", "VREX", "CTO", "GOOD", "DIN", "CZNC", "GIC", "RYAM", "JMSB", "MCW", "KELYA", "RC", "PRTH", "SFIX", "XRX", "CTKB", "TCMD", "DSGR", "SPOK", "NBR", "NBN", "EGY", "NLOP", "CRNC", "EBF", "OPRX", "ACTG", "CMCO", "NCMI", "AMBC", "RES", "MCS", "TNGX", "MCFT", "LMNR", "FWRG", "GDEN", "SRDX", "OLMA", "BOW", "KROS", "FRST", "GDYN", "SHBI", "TYRA", "HDSN", "AEBI", "FMAO", "ACCO", "FDBC", "CTOS", "SCVL", "YORW", "MBI", "FPI", "PX", "ZIP", "KRNY", "HVT", "GPRE", "RMNI", "SIGA", "WNC", "MITK", "WASH", "LAB", "CNDT", "GTN", "PKST", "MLAB", "WEAV", "AKBA", "REFI", "MAX", "HY", "AHH", "ZEUS", "DOMO", "BFS", "JELD", "PUBM", "PACK", "BVS", "CBLL", "GCO", "SVC", "OLP", "ALT", "LILA", "HTLD", "SLQT", "TERN", "CYRX", "PLTK", "MTW", "MGPI", "MRVI", "TITN", "REAX", "FNLC", "MSBI", "RBB", "CVGW", "ARKO", "CMRC", "BBBY", "RPAY", "CIO", "GRND", "JACK", "ARCT", "DHIL", "SITC", "AVNW", "SEMR", "LXFR", "DDD", "PSFE", "CLMB", "REPX", "KRUS", "NVEC", "PANL", "LAND", "IHRT", "TWI", "OEC", "CHCT", "EVGO", "CLDT", "XPER", "CRSR", "ONTF", "RBBN", "TG", "MOV", "CENT", "TRUE", "OOMA", "CLW", "DNUT", "RDW", "IPI", "OMI", "IRWD", "BRY", "NFE", "CMTG", "QSI", "VMD", "CZFS", "WOW", "NXDR", "USNA", "RICK", "ANNX", "CMT", "TH", "FC", "ALDX", "WOOF", "EOLS", "GMRE", "SLP", "INBK", "RXST", "GETY", "BLFY", "WTI", "RCKT", "KALV", "FRGE", "DENN", "TMCI", "DSP", "NRDS", "NEWT", "RHLD", "CRCT", "UTMD", "BGS", "SB", "ATEX", "UIS", "VNDA", "DBI", "IVR", "MCHB", "QTRX", "LRMR", "MEI", "BOC", "SVV", "FFWM", "MASS", "RMR", "LAW", "EPM", "BSRR", "AVIR", "GNE", "DSGN", "AGL", "JOUT", "PSTL", "CERS", "EDIT", "BHR", "AMCX", "SEG", "ANIK", "POWW", "JAKK", "PTLO", "OSUR", "ULH", "ALTG", "ASLE", "HNST", "TRDA", "TCX", "ONEW", "CVRX", "NNOX", "ENTA", "LOVE", "AURA", "NRC", "KLC", "LPRO", "THRY", "PRME", "DMRC", "EGHT", "BOOM", "EVC", "MVIS", "ADV", "ACRE", "INSE", "RGP", "TBI", "CAPR", "KIDS", "ACDC", "BCBP", "CMDB", "RMAX", "CRMT", "WEST", "ATNI", "-", "ARAY", "JRVR", "TCBX", "VYGR", "EB", "CATX", "TTGT", "HUMA", "ULCC", "MED", "MNTK", "INGN", "FLWS", "MXCT", "INR", "HCAT", "AVD", "CDXS", "CBAN", "NXDT", "SKIN", "STRZ", "OLPX", "XPOF", "HRTX", "SSP", "IMMR", "ALLO", "SNBR", "OABI", "GLIBA", "OFLX", "ASUR", "FATE", "RCEL", "CHRS", "DH", "MYPS", "FORR", "ATYR", "EWCZ", "DCGO", "SSTI", "HAIN", "ALMS", "BYND", "FNKO", "ALEC", "WALD", "AFCG", "SUNS", "BRCC", "NKTX", "LUNG", "TTEC", "SEAT", "INH", "LAZR", "TEAD", "ADRO"]
for i in tradeable:
    try:
        time.sleep(0.1)
        request_params = StockBarsRequest(
            symbol_or_symbols=[str(i)],
            timeframe=TimeFrame.Day,
            start=datetime(yesterday.year, yesterday.month, yesterday.day),
            end=datetime(yesterday.year, yesterday.month, today.day)
        )
        bars = client.get_stock_bars(request_params)
        data = bars[str(i)]
        latestBar = data[-1]
        close = latestBar.close
        open = latestBar.open
        percentageChange = (close / open - 1) * 100
        if percentageChange > 0:
            buy(i, abs(percentageChange * riskTolerance), "bull")
            print(f"BUY {i} for USD${round(percentageChange * riskTolerance,2)}")
            amtTotal += round(percentageChange * riskTolerance, 2)
        elif percentageChange < 0:
            qtyTemp = int(abs(percentageChange * riskTolerance) / close)
            buy(i, qtyTemp, "bear")
            print(f"SELL {i} for USD${(qtyTemp)* close }.")
            amtTotal += (qtyTemp) * close
        else:
            print("No trade was executed for " + str(i) + ".")
        count += 1
    except Exception:
        print(f"Error with {i}, continuing.")
        continue
print(f"Total {count} trades executed for a total cost of USD${round(amtTotal,2)}.")
